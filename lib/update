#!/usr/bin/env zsh

# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
# Script: Update
#
# This script will update the dotfiles repository.
#
# â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

# --- 1. Pull latest dotfiles safely
print "ğŸ”„  Updating dotfiles repository..."

if [[ -n "$(git status --porcelain)" ]]; then
	print "âš ï¸  Uncommitted changes detected."
	if gum confirm "Stash local changes before pulling?"; then
		git stash push -m "dotfilesâ€‘autoâ€‘stash $(date '+%F %T')"
	else
		print "ğŸš«  Aborting update."; return 1
	fi
fi

git pull --rebase --autostash

# --- 2. Re-link dotfiles (idempotent)
print "\nğŸ”—  Re-linking dotfiles..."

# --- 3. Sync Homebrew (optional)
if gum confirm "Run brew bundle to match Brewfile?"; then
	brew bundle --file="$ROOT_DIR/Brewfile"
fi

# --- 4. Re-run any post-install hooks
# "$SCRIPT_DIR/shell"
# "$SCRIPT_DIR/macos"