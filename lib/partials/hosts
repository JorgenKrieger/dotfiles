#!/usr/bin/env zsh

# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
# Requires: sudo
# ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ

HOSTS_URL="https://raw.githubusercontent.com/StevenBlack/hosts/master/alternates/fakenews-gambling/hosts"
TMP_FILE="/tmp/hosts.downloaded"
FINAL_FILE="/etc/hosts"

echo "‚¨áÔ∏è  Downloading latest hosts file..."
curl -fsSL "$HOSTS_URL" -o "$TMP_FILE"

# Check if CUSTOM HOSTS block exists
if grep -q "# CUSTOM HOSTS START" "$FINAL_FILE" && grep -q "# CUSTOM HOSTS END" "$FINAL_FILE"; then
	echo "üîç Found CUSTOM HOSTS block. Preserving it."

	# Extract everything between the markers
	CUSTOM_BLOCK=$(awk '/# CUSTOM HOSTS START/{flag=1;print;next}/# CUSTOM HOSTS END/{print;flag=0}flag' "$FINAL_FILE")

	# Write final hosts file
	{
		echo "$CUSTOM_BLOCK"
		echo
		cat "$TMP_FILE"
	} | sudo tee "$FINAL_FILE" > /dev/null

	echo "‚úÖ /etc/hosts updated (custom block preserved)."

else
	echo "‚ö†Ô∏è No CUSTOM HOSTS block found. Replacing entire /etc/hosts."
	sudo cp "$TMP_FILE" "$FINAL_FILE"
	echo "‚úÖ /etc/hosts replaced completely."
fi